# 语音转文字功能配置指南

## 🎯 快速开始

### 1. 获取百度语音识别 API 密钥

1. **注册百度智能云账号**
   - 访问：https://cloud.baidu.com/
   - 注册并登录账号

2. **创建语音识别应用**
   - 进入控制台：https://console.bce.baidu.com/ai/#/ai/speech/app/list
   - 点击"创建应用"
   - 填写应用信息（应用名称、应用描述等）
   - 提交创建

3. **获取 API 凭证**
   - 在应用列表中找到刚创建的应用
   - 记录 `API Key` 和 `Secret Key`

### 2. 配置项目环境变量

1. **创建环境配置文件**
   ```bash
   cp .env.template .env
   ```

2. **编辑 .env 文件**
   ```bash
   # 百度语音识别 API 配置
   EXPO_PUBLIC_BAIDU_API_KEY=你的_API_KEY
   EXPO_PUBLIC_BAIDU_SECRET_KEY=你的_SECRET_KEY
   ```

### 3. 重启开发服务器
```bash
npm start
# 或
expo start
```

## 🎤 功能说明

### 语音录制
- **长按开始录制**: 按住"Hold to Speak"按钮开始录音
- **松开结束录制**: 松开按钮自动停止录音并开始识别
- **实时音量波形**: 录音过程中显示实时音量变化
- **最大录音时长**: 60秒

### 语音识别
- **自动识别**: 录音结束后自动调用百度语音识别API
- **实时状态**: 显示录音、处理、完成或错误状态
- **自动发送**: 识别成功后自动发送消息
- **错误处理**: 网络异常、权限拒绝等错误提示

### 状态指示
- `Hold to Speak` - 待机状态
- `Recording...` - 正在录音
- `Processing...` - 正在识别
- `Done!` - 识别完成
- `Error` - 发生错误

## 🔧 技术架构

### 录音模块 (`utils/audioRecording.ts`)
- 使用 `expo-audio` 进行录音
- 权限管理和错误处理
- 实时音量级别获取
- 录音状态管理

### 语音识别模块 (`utils/speechRecognition.ts`)
- 百度语音识别 API 封装
- Token 自动获取和缓存
- 音频文件 Base64 转换
- 网络请求和错误处理

### 类型定义 (`utils/speechTypes.ts`)
- TypeScript 类型定义
- 状态枚举和接口
- 错误代码映射

### 配置管理 (`utils/speechConfig.ts`)
- 环境变量读取
- 配置验证
- 状态检查

## 🚀 使用示例

```typescript
import { useAudioRecording } from 'utils/audioRecording';
import { recognizeSpeech } from 'utils/speechRecognition';

// 在组件中使用
const { recordingState, startRecording, stopRecording } = useAudioRecording({
  onRecordingComplete: async (audioUri) => {
    const result = await recognizeSpeech(audioUri);
    if (result.text) {
      console.log('识别结果:', result.text);
    }
  },
  onRecordingError: (error) => {
    console.error('录音错误:', error);
  }
});
```

## 🐛 常见问题

### 1. "请配置百度 API Key"
- 检查 `.env` 文件是否存在
- 确认 API Key 和 Secret Key 已正确填写
- 重启开发服务器

### 2. "录音权限被拒绝"
- iOS: 检查设置 → 隐私 → 麦克风，允许应用访问
- Android: 检查应用权限设置，允许录音权限

### 3. "语音识别失败"
- 检查网络连接
- 确认百度 API 凭证有效
- 查看控制台错误日志

### 4. 录音无声音波形
- 检查设备麦克风是否正常
- 确认录音权限已授予
- 尝试重启应用

## 📱 设备兼容性

### 支持平台
- ✅ iOS (真机)
- ✅ Android (真机)
- ❌ Web (录音API限制)
- ❌ 模拟器 (无麦克风硬件)

### 推荐测试环境
- 真实设备测试
- 安静环境录音
- 清晰发音

---

## 📞 技术支持

如有问题，请检查：
1. 控制台日志信息
2. 网络连接状态
3. API 配置正确性
4. 设备权限设置

*配置完成后，重启应用即可体验语音转文字功能！* 🎉
